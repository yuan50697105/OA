<#assign ctx=request.contextPath>
<link href="${ctx}/css/list/list_style.css" rel="stylesheet" type="text/css"/>
<div class="rightinfo">
    <script>
        $(function () {
            $("#checkAll").click(function () {
                //设置复选框全选或反选
                $("input[type='checkbox'][id^='box_']").attr("checked", this.checked);
            });

            $("#deleteBtn").click(function () {
                //获取所有选中的复选框
                var boxs = $("input[id^='box_']:checked");
                if (boxs.length == 0) {
                    var d = dialog({
                        title: '温馨提示',
                        content: '请选择需要删除的计划!',
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                    }, 1000);
                } else {
                    var d = dialog({
                        title: '温馨提示',
                        content: '您确定要删除所选的工作计划?',
                        okValue: '确定',
                        ok: function () {
                            //删除操作
                            delWork();
                        },
                        cancelValue: '取消',
                        cancel: function () {
                            d.close().remove();
                        }
                    });
                    d.show();
                }
            });
        });

        function delWork() {
            var boxs = $("input[id^='box_']:checked");
            var ids = boxs.map(function (i, item) {
                return item.value;
            });

            var params = {"noticeIds": ids.get().join('-')};
            var url = "${ctx}/notice/ajaxDelNotice";
            $.post(url, params, function (flag) {
                if (flag) {
                    var d = dialog({
                        title: '温馨提示',
                        content: '删除成功',
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                        //刷新当前界面
                        window.location.href = window.location.href;
                    }, 1000);
                }
            }, "json");
        }
        function delSingleWork(noticeId) {
            var params = {"noticeId": noticeId};
            var url = "${ctx}/notice/ajaxDelSingleNotice";
            $.post(url, params, function (flag) {
                if (flag) {
                    var d = dialog({
                        title: '温馨提示',
                        content: '删除成功',
                    });
                    d.show();
                    setTimeout(function () {
                        d.close().remove();
                        //刷新当前界面
                        window.location.href = window.location.href;
                    }, 1000);
                }
            }, "json");
        }
    </script>
    <table class="tablelist">
        <thead>
        <tr>
            <th><input name="checkAll" id="checkAll" type="checkbox"/></th>
            <th>公告标题</th>
            <th>公告内容</th>
            <th>公告类型</th>
            <th>发布时间</th>
            <th>操作</th>
        </tr>
        </thead>

    <#if noticeList??>
        <#list noticeList as notice>
            <tbody id="tbody_${notice.noticeId}">
            <tr>
                <td style="width:25px;">
                    <input id="box_${notice.noticeId}" name="box_${notice.noticeId}" type="checkbox"
                           value="${notice.noticeId}"/>
                </td>
                <td style="width:150px;">${notice.noticeName}</td>
                <td style="width:250px;">${notice.notice}</td>
                <td style="width:100px;">
                    <#if notice.noticeType=="1">
                        制度
                    <#elseif notice.noticeType=="2">
                        通知
                    <#else>
                        新闻
                    </#if>
                </td>
                <td style="width:100px;">${notice.publishTime?string("yyyy-MM-dd")}</td>
                <td>
                    <a href="${ctx}/notice/getNotice?noticeId=${notice.noticeId}" class="tablelink">查看</a>&nbsp;|&nbsp;
                    <a href="javascript:void(0);" id="deleteBtn2" onclick="delSingleWork(${notice.noticeId})" class="tablelink">删除</a>
                </td>
            </tr>

            </tbody>
        </#list>
    </#if>
    </table>
</div>